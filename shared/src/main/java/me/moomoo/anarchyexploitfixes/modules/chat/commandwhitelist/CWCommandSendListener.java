package me.moomoo.anarchyexploitfixes.modules.chat.commandwhitelist;

import me.moomoo.anarchyexploitfixes.enums.AEFPermission;
import org.bukkit.event.EventHandler;
import org.bukkit.event.EventPriority;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerCommandSendEvent;

import java.util.Set;

public class CWCommandSendListener implements Listener {

    private final Set<String> allowedCommands;

    public CWCommandSendListener(Set<String> allowedCommands) {
        this.allowedCommands = allowedCommands;
    }

    @EventHandler(priority = EventPriority.HIGH)
    private void onInitialTabCompleteListSend(PlayerCommandSendEvent event) {
        if (!event.getPlayer().hasPermission(AEFPermission.BYPASS_CMD_WHITELIST.get())) {
            event.getCommands().removeIf(cmd -> !allowedCommands.contains(cmd));
        }
    }

    public static boolean isSupported() {
        try {
            Class.forName("org.bukkit.event.player.PlayerCommandSendEvent");
            return true;
        } catch (ClassNotFoundException e) {
            return false;
        }
    }
}
